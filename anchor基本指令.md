[Anchor开发指南](https://leapwhale.com/article/9dk17j5q)

# anchor 基本指令（一）

### `anchor init` 创建新项目

这个命令用于创建一个新的 Anchor 项目，包含了 demo 代码，你可以用自己的项目名称替换 **my_project**

```
anchor init my_project
```

如果失败报错需要检查 solana 环境以及依赖项是否都已安装或更新

### `anchor new` 创建新程序

这个命令用于在项目的 programs 下创建一个新的程序

```
anchor new my_program
```

### `anchor build` 编译项目

这个命令用于构建和编译程序。它会在 **`target/deploy`**目录下生成编译后的合约二进制文件。如果在项目目录下可以省略项目名称

```
anchor build [my_project]
```

### `anchor test` 测试程序

运行这个命令会执行程序的测试套件，确保程序的功能正常

```
anchor test
```

### `anchor deploy` 部署项目

Solana 的 devnet 是一个专门用于开发和测试的网络，通常我们会把项目先部署在本地或者开发测试网进行验证，验证通过后部署到主网 mainnet-beta

```
// 部署到开发测试网
anchor deploy --env devnet
// 部署到主网
anchor deploy --env mainnet-beta
```

# 项目目录结构：

创建完项目 **my_project** 后，我们进入 **my_project** 文件夹， 可以看到 Anchor 自动生成的文件和目录：

```
my_project/
├── Anchor.toml
├── programs/
│   └── my_program/
│       ├── Cargo.toml
│       ├── src/
│       │   └── lib.rs
│       └── tests/
│           └── program_test.rs
├── target/
└── tests/
    └── integration_test.rs
```

这是一个简化的结构，提供了一个基本的框架，使你能够开始编写、测试和部署程序。在具体的项目中，你可能需要根据需求添加其他文件和目录，例如配置文件、文档等。以下是一些关键文件和目录的说明：



- **Anchor.toml**： 项目的配置文件，包含项目的基本信息、依赖关系和其他配置项。

- **programs** 目录：包含你的程序的目录。在这个例子中，有一个名为 **my_program** 的子目录。

  - **Cargo.toml**： 程序的Rust项目配置文件。

  - **src** 目录**：** 包含实际的程序代码文件，通常是 **lib.rs**，在实际的项目中我们会根据模块划分，拆的更细。

  - **tests** 目录**：** 包含用于测试程序的测试代码文件。

- **target** 目录**：** 包含构建和编译生成的文件。

- **tests ** 目录**：** 包含整合测试代码文件，用于测试整个项目的集成性能。

# anchor 基本指令（二）

### `anchor help` 帮助命令

获取相关子指令的详细信息，打印出所有可用命令的列表 **`anchor help`**

```
anchor help

available commands:
  init      初始化一个工作空间。
  build     构建整个工作空间。
  expand    展开宏（cargo expand 的包装）。
  verify    验证链上字节码是否与本地编译的构件匹配。在程序子目录中运行此命令，即包含程序的 Cargo.toml 文件的目录。
  test      在本地网络运行集成测试。
  new       创建一个新的程序。
  idl       与接口定义语言（IDL）交互的命令。
  clean     从目标目录中删除除程序密钥对之外的所有构建产物。
  deploy    部署工作空间中的每个程序。
  migrate   运行部署迁移脚本。
  upgrade   部署、初始化接口定义并一次性迁移所有内容的命令。升级单个程序。配置的钱包必须是升级权限。
  cluster   集群命令。
  shell     启动一个带有 anchor 客户端设置的节点 shell。
  run       运行由当前工作空间的 anchor.toml 定义的脚本。
  login     将来自注册表的 API 令牌保存到本地。
  publish   将经过验证的构建发布到 anchor 注册表。
  keys      密钥对命令。
  localnet  本地网络命令。
  account   使用提供的接口定义获取并反序列化帐户。
  help      打印此消息或给定子命令的帮助信息。
```

打印给定子命令的帮助信息：**`anchor help [subcommand]`**

例如，如果你想获取有关deploy命令的帮助信息，可以执行以下命令：

```
anchor help deploy
```

这将显示关于deploy命令的用法、选项和示例。帮助信息通常包括有关如何正确使用命令的说明，以及可用选项的详细描述。帮助命令是理解和学习 Anchor 框架的重要工具，因为它提供了有关每个命令的详细信息，帮助你正确使用这些命令来开发和管理Solana上的程序

### `anchor verify` 一致性验证

该指令用于验证链上部署的程序的字节码是否与本地编译的构件（artifact）匹配。这个命令通常在开发者部署程序到 Solana 区块链之后使用，以确保链上的合约与本地开发环境中的代码一致。

在使用这个命令时，你需要在包含程序程序的目录中运行，即包含程序的 `Cargo.toml` 文件的目录。执行 `anchor verify` 会比较链上合约的字节码和本地编译的构件，确保它们一致

验证的过程通常包括以下步骤：

- 1.检查链上合约的程序 ID 是否与本地编译的程序 ID 一致。

- 2.对比链上合约的字节码和本地编译的构件，确保它们相匹配

### `anchor upgrade` 程序升级

该命令是用于一次性升级程序的命令。它的作用是部署、初始化接口定义（IDL），并将执行所有迁移的过程集成在一起。这个命令通常用于升级一个单独的程序，而不是整个工作空间。这个命令会执行以下步骤：

- **1.部署最新版本的程序：**意味着将程序的最新版本上传到 Solana 区块链网络上，并在链上创建一个新的程序实例。这个过程涉及将新的程序二进制文件部署到链上，以便替换先前部署的程序版本。

- **2.初始化接口定义**（IDL）：IDL 是一种描述程序接口的语言，用于定义合约的数据结构、方法和事件。初始化接口定义的过程是将这些接口定义部署到链上，以便客户端能够与程序进行交互，并能够正确地解析合约的数据结构和方法。

- **3.执行所有必要的迁移脚本**：迁移脚本是用于在合约升级或修改时执行的脚本。它包含了在链上执行的逻辑，例如更新存储结构、迁移数据等。迁移脚本的目的是确保链上合约状态的平滑过渡，使新版本的合约能够与旧版本兼容
